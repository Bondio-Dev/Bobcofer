# README.md

**Bobcofer** — система автоматизированной массовой рассылки WhatsApp-сообщений через Telegram-бот с интеграцией в amoCRM.

## Описание проекта

Система позволяет создавать массовые WhatsApp-рассылки используя шаблоны Gupshup API, управлять ими через Telegram-бота и интегрироваться с CRM-системами для получения контактов, а также генерировать детальные отчёты по доставке сообщений[^1].

## Структура проекта

### Основные Python-модули

#### `main.py` — консольная утилита для работы с amoCRM

- **`AmoCRMCategoryManager`** — класс для интеграции с amoCRM/Kommo API
- **`get_pipelines()`**, **`get_leads()`** — получение воронок и сделок из CRM
- **`normalize_phone()`** — нормализация телефонных номеров к международному формату E.164
- **`build_funnels_snapshot()`** — создание снимков статусов воронки для бота
- Консольный интерфейс для тестирования функций CRM[^1]


#### `bot.py` — модуль отправки сообщений через Gupshup API

- **`send_template()`** — отправка WhatsApp-сообщений по шаблонам
- **`log_message()`** — логирование результатов отправки в CSV
- Поддержка массовой и одиночной отправки сообщений
- Обработка ошибок и таймаутов API[^1]


#### `tgbot.py` — основной Telegram-бот для управления рассылками

- **`AmoCRMCategoryManager`** — дублированный класс CRM для асинхронной работы
- **`fetch_templates()`** — получение шаблонов из Gupshup
- **`send_via_bot_py()`** — асинхронная отправка через bot.py
- **`SimpleJobQueue`** — планировщик задач для отложенной отправки
- **`JsonFormatter`** — структурированное логирование в JSON формат
- FSM (конечные автоматы) для управления состояниями бота
- Админ-панель с ролевым доступом[^1]


#### `report.py` — генерация отчётов по рассылкам

- **`generate_delivery_stats_report()`** — создание текстовых отчётов по статистике доставки
- Фильтрация по датам
- Подсчёт успешных и неудачных доставок
- Экспорт ошибочных номеров[^1]


### Конфигурационные файлы

- **`conf.json`** — настройки amoCRM (поддомен, токен доступа)
- **`token.json`** — токен Telegram-бота
- **`admins.json`** — список ID администраторов бота
- **`contacts.json`** — база контактов для рассылки
- **`data.json`** — параметры шаблонов сообщений
- **`scheduled.json`** — запланированные задачи рассылки[^1]


### Служебные файлы

- **`Dockerfile`** — контейнеризация приложения
- **`docker-compose.yml`** — оркестрация с монтированием данных
- **`requarements.txt`** — Python-зависимости включая pandas>=2.1.0, aiogram, requests, phonenumbers
- **`Makefile`** — автоматизация сборки и развёртывания
- **`.env`** — переменные окружения[^1]


### Директории

- **`logs/`** — CSV-файлы логов доставки и ошибочных номеров
- **`amocrm_contacts/`** — кэш контактов из CRM
- **`data/`** — дополнительные файлы данных[^1]
